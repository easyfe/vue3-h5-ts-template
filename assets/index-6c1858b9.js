import{c as e,t as a,n as t,z as i,K as l,u as s,f as o,S as n,T as r,a3 as u,A as v,D as c,F as h,a4 as p,M as f,N as d,w as g,d as w}from"./index-e5fbf354.js";import{v as m,r as x,a as y,h as b,w as C,k as S,l as z,p as M,y as $,x as T,n as k}from"./core-314477b5.js";const[D,I]=e("swipe"),O={loop:a,width:t,height:t,vertical:Boolean,autoplay:i(0),duration:i(500),touchable:a,lazyRender:Boolean,initialSwipe:i(0),indicatorColor:String,showIndicators:a,stopPropagation:a},X=Symbol(D);const Y=g(m({name:D,props:O,emits:["change","dragStart","dragEnd"],setup(e,{emit:a,slots:t}){const i=x(),g=x(),w=y({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let m=!1;const D=l(),{children:O,linkChildren:Y}=s(X),E=b((()=>O.length)),P=b((()=>w[e.vertical?"height":"width"])),j=b((()=>e.vertical?D.deltaY.value:D.deltaX.value)),A=b((()=>{if(w.rect){return(e.vertical?w.rect.height:w.rect.width)-P.value*E.value}return 0})),B=b((()=>P.value?Math.ceil(Math.abs(A.value)/P.value):E.value)),F=b((()=>E.value*P.value)),R=b((()=>(w.active+E.value)%E.value)),H=b((()=>{const a=e.vertical?"vertical":"horizontal";return D.direction.value===a})),K=b((()=>{const a={transitionDuration:`${w.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+w.offset.toFixed(2)}px)`};if(P.value){const t=e.vertical?"height":"width",i=e.vertical?"width":"height";a[t]=`${F.value}px`,a[i]=e[i]?`${e[i]}px`:""}return a})),N=(a,t=0)=>{let i=a*P.value;e.loop||(i=Math.min(i,-A.value));let l=t-i;return e.loop||(l=d(l,A.value,0)),l},W=({pace:t=0,offset:i=0,emitChange:l})=>{if(E.value<=1)return;const{active:s}=w,o=(a=>{const{active:t}=w;return a?e.loop?d(t+a,-1,E.value):d(t+a,0,B.value):t})(t),n=N(o,i);if(e.loop){if(O[0]&&n!==A.value){const e=n<A.value;O[0].setOffset(e?F.value:0)}if(O[E.value-1]&&0!==n){const e=n>0;O[E.value-1].setOffset(e?-F.value:0)}}w.active=o,w.offset=n,l&&o!==s&&a("change",R.value)},q=()=>{w.swiping=!0,w.active<=-1?W({pace:E.value}):w.active>=E.value&&W({pace:-E.value})},G=()=>{q(),D.reset(),h((()=>{w.swiping=!1,W({pace:1,emitChange:!0})}))};let J;const L=()=>clearTimeout(J),Q=()=>{L(),+e.autoplay>0&&E.value>1&&(J=setTimeout((()=>{G(),Q()}),+e.autoplay))},U=(a=+e.initialSwipe)=>{if(!i.value)return;const t=()=>{var t,l;if(!p(i)){const a={width:i.value.offsetWidth,height:i.value.offsetHeight};w.rect=a,w.width=+(null!=(t=e.width)?t:a.width),w.height=+(null!=(l=e.height)?l:a.height)}E.value&&-1===(a=Math.min(E.value-1,a))&&(a=E.value-1),w.active=a,w.swiping=!0,w.offset=N(a),O.forEach((e=>{e.setOffset(0)})),Q()};p(i)?k().then(t):t()},V=()=>U(w.active);let Z;const _=a=>{!e.touchable||a.touches.length>1||(D.start(a),m=!1,Z=Date.now(),L(),q())},ee=()=>{if(!e.touchable||!w.swiping)return;const t=Date.now()-Z,i=j.value/t;if((Math.abs(i)>.25||Math.abs(j.value)>P.value/2)&&H.value){const a=e.vertical?D.offsetY.value:D.offsetX.value;let t=0;t=e.loop?a>0?j.value>0?-1:1:0:-Math[j.value>0?"ceil":"floor"](j.value/P.value),W({pace:t,emitChange:!0})}else j.value&&W({pace:0});m=!1,w.swiping=!1,a("dragEnd",{index:R.value}),Q()},ae=(a,t)=>{const i=t===R.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return T("i",{style:l,class:I("indicator",{active:i})},null)};return o({prev:()=>{q(),D.reset(),h((()=>{w.swiping=!1,W({pace:-1,emitChange:!0})}))},next:G,state:w,resize:V,swipeTo:(a,t={})=>{q(),D.reset(),h((()=>{let i;i=e.loop&&a===E.value?0===w.active?0:a:a%E.value,t.immediate?h((()=>{w.swiping=!1})):w.swiping=!1,W({pace:i-w.active,emitChange:!0})}))}}),Y({size:P,props:e,count:E,activeIndicator:R}),C((()=>e.initialSwipe),(e=>U(+e))),C(E,(()=>U(w.active))),C((()=>e.autoplay),Q),C([n,r,()=>e.width,()=>e.height],V),C(u(),(e=>{"visible"===e?Q():L()})),S(U),z((()=>U(w.active))),v((()=>U(w.active))),M(L),$(L),c("touchmove",(t=>{if(e.touchable&&w.swiping&&(D.move(t),H.value)){!e.loop&&(0===w.active&&j.value>0||w.active===E.value-1&&j.value<0)||(f(t,e.stopPropagation),W({offset:j.value}),m||(a("dragStart",{index:R.value}),m=!0))}}),{target:g}),()=>{var a;return T("div",{ref:i,class:I()},[T("div",{ref:g,style:K.value,class:I("track",{vertical:e.vertical}),onTouchstartPassive:_,onTouchend:ee,onTouchcancel:ee},[null==(a=t.default)?void 0:a.call(t)]),t.indicator?t.indicator({active:R.value,total:E.value}):e.showIndicators&&E.value>1?T("div",{class:I("indicators",{vertical:e.vertical})},[Array(E.value).fill("").map(ae)]):void 0])}}})),[E,P]=e("swipe-item");const j=g(m({name:E,setup(e,{slots:a}){let t;const i=y({offset:0,inited:!1,mounted:!1}),{parent:l,index:s}=w(X);if(!l)return;const n=b((()=>{const e={},{vertical:a}=l.props;return l.size.value&&(e[a?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${a?"Y":"X"}(${i.offset}px)`),e})),r=b((()=>{const{loop:e,lazyRender:a}=l.props;if(!a||t)return!0;if(!i.mounted)return!1;const o=l.activeIndicator.value,n=l.count.value-1,r=0===o&&e?n:o-1,u=o===n&&e?0:o+1;return t=s.value===o||s.value===r||s.value===u,t}));return S((()=>{k((()=>{i.mounted=!0}))})),o({setOffset:e=>{i.offset=e}}),()=>{var e;return T("div",{class:P(),style:n.value},[r.value?null==(e=a.default)?void 0:e.call(a):null])}}}));export{j as S,Y as a};
