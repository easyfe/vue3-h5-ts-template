var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,o=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&n(e,a,t[a]);if(s)for(var a of s(t))l.call(t,a)&&n(e,a,t[a]);return e},r=(e,s)=>t(e,a(s));import{c as u,z as d,m as c,t as h,ah as v,f,D as p,E as g,a4 as m,O as y,w,n as x,K as b,ai as k,M as T,_}from"./index-ac951421.js";import{v as O,r as $,h as D,w as j,ac as B,k as q,x as P,n as S,a as H,N as K,O as V,F as z,Y as C,u as I,a0 as E,$ as A,g as M,Q as U,P as Y,b as L,ad as W,X as F,A as N,a1 as Q}from"./core-314477b5.js";import{d as R}from"./index-7a246152.js";import{_ as X}from"./index.vue_vue_type_style_index_0_lang-e1c46f1d.js";import{u as G}from"./use-tab-status-e732bd88.js";const[J,Z,ee]=u("list");const te=w(O({name:J,props:{error:Boolean,offset:d(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:c("down"),loadingText:String,finishedText:String,immediateCheck:h},emits:["load","update:error","update:loading"],setup(e,{emit:t,slots:a}){const s=$(e.loading),i=$(),l=$(),n=G(),o=v(i),r=D((()=>e.scroller||o.value)),u=()=>{S((()=>{if(s.value||e.finished||e.disabled||e.error||!1===(null==n?void 0:n.value))return;const{direction:a}=e,o=+e.offset,u=g(r);if(!u.height||m(i))return;let d=!1;const c=g(l);d="up"===a?u.top-c.top<=o:c.bottom-u.bottom<=o,d&&(s.value=!0,t("update:loading",!0),t("load"))}))},d=()=>{if(e.finished){const t=a.finished?a.finished():e.finishedText;if(t)return P("div",{class:Z("finished-text")},[t])}},c=()=>{t("update:error",!1),u()},h=()=>{if(e.error){const t=a.error?a.error():e.errorText;if(t)return P("div",{role:"button",class:Z("error-text"),tabindex:0,onClick:c},[t])}},w=()=>{if(s.value&&!e.finished&&!e.disabled)return P("div",{class:Z("loading")},[a.loading?a.loading():P(y,{class:Z("loading-icon")},{default:()=>[e.loadingText||ee("loading")]})])};return j((()=>[e.loading,e.finished,e.error]),u),n&&j(n,(e=>{e&&u()})),B((()=>{s.value=e.loading})),q((()=>{e.immediateCheck&&u()})),f({check:u}),p("scroll",u,{target:r,passive:!0}),()=>{var t;const n=null==(t=a.default)?void 0:t.call(a),o=P("div",{ref:l,class:Z("placeholder")},null);return P("div",{ref:i,role:"feed",class:Z(),"aria-busy":s.value},["down"===e.direction?n:o,w(),d(),h(),"up"===e.direction?n:o])}}})),[ae,se,ie]=u("pull-refresh"),le=["pulling","loosing","success"];const ne=w(O({name:ae,props:{disabled:Boolean,modelValue:Boolean,headHeight:d(50),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:x,successDuration:d(500),animationDuration:d(300)},emits:["change","refresh","update:modelValue"],setup(e,{emit:t,slots:a}){let s;const i=$(),l=$(),n=v(i),o=H({status:"normal",distance:0,duration:0}),r=b(),u=()=>{if(50!==e.headHeight)return{height:`${e.headHeight}px`}},d=()=>"loading"!==o.status&&"success"!==o.status&&!e.disabled,c=(a,s)=>{const i=+(e.pullDistance||e.headHeight);o.distance=a,o.status=s?"loading":0===a?"normal":a<i?"pulling":"loosing",t("change",{status:o.status,distance:a})},h=()=>{const{status:t}=o;return"normal"===t?"":e[`${t}Text`]||ie(t)},f=()=>{const{status:e,distance:t}=o;if(a[e])return a[e]({distance:t});const s=[];return le.includes(e)&&s.push(P("div",{class:se("text")},[h()])),"loading"===e&&s.push(P(y,{class:se("loading")},{default:h})),s},g=e=>{s=0===k(n.value),s&&(o.duration=0,r.start(e))},m=e=>{d()&&g(e)},w=()=>{s&&r.deltaY.value&&d()&&(o.duration=+e.animationDuration,"loosing"===o.status?(c(+e.headHeight,!0),t("update:modelValue",!0),S((()=>t("refresh")))):c(0))};return j((()=>e.modelValue),(t=>{o.duration=+e.animationDuration,t?c(+e.headHeight,!0):a.success||e.successText?(o.status="success",setTimeout((()=>{c(0)}),+e.successDuration)):c(0,!1)})),p("touchmove",(t=>{if(d()){s||g(t);const{deltaY:a}=r;r.move(t),s&&a.value>=0&&r.isVertical()&&(T(t),c((t=>{const a=+(e.pullDistance||e.headHeight);return t>a&&(t=t<2*a?a+(t-a)/2:1.5*a+(t-2*a)/4),Math.round(t)})(a.value)))}}),{target:l}),()=>{var e;const t={transitionDuration:`${o.duration}ms`,transform:o.distance?`translate3d(0,${o.distance}px, 0)`:""};return P("div",{ref:i,class:se()},[P("div",{ref:l,class:se("track"),style:t,onTouchstartPassive:m,onTouchend:w,onTouchcancel:w},[P("div",{class:se("head"),style:u()},[f()]),null==(e=a.default)?void 0:e.call(a)])])}}})),oe={getWidthHeight:(e,t=2500)=>new Promise(((a,s)=>{const i=new Image;if(i.src=e,i.complete){const{width:e,height:t}=i;return void a({width:e,height:t})}const l=setTimeout((()=>{s("图片加载失败！")}),t);i.onload=function(){const{width:e,height:t}=i;window.clearTimeout(l),a({width:e,height:t})}}))},re={class:"masonry-content"},ue=O({name:"BaseMasonry"}),de=_(O(r(o({},ue),{props:{gutter:{default:1},columns:{default:2},list:{},init:{type:Boolean,default:!0}},setup(e){const t=e,a=$([]);let s=0;return j((()=>t.init),(e=>{e&&(s=0)})),j((()=>t.list),(e=>{var i;for(t.init&&(a.value=[]);s<e.length;){const l=s%t.columns;a.value[l]||(a.value[l]={list:[],height:0});const n=e[s];null==(i=a.value[l])||i.list.push(n),oe.getWidthHeight(n.image).then((e=>{n._width=e.width,n._height=e.height})),s++}}),{deep:!0}),(e,i)=>(K(),V("div",re,[(K(!0),V(z,null,C(I(a),((a,i)=>(K(),V("div",{key:i,class:"masonry-list",style:E({width:100/t.columns-t.gutter+"%"})},[(K(!0),V(z,null,C(a.list,((t,a)=>A(e.$slots,"item",{key:a,row:t,index:I(s)},void 0,!0))),128))],4)))),128))]))}})),[["__scopeId","data-v-261f87c1"]]),ce={key:1,class:"empty-wrapper"},he=O({name:"BaseList"}),ve=_(O(r(o({},he),{props:{masonry:{type:Boolean,default:!1},masonryConfig:{default:null},contentClass:{default:""},pull:{type:Boolean,default:!0},req:{default:null},rowKey:{default:""},active:{default:""},list:{default:()=>[]},emptyType:{default:"result"},emptyImage:{default:""},emptyDesc:{default:""},finishedText:{default:"没有更多数据了"},size:{default:10},pageKey:{default:"page"},sizeKey:{default:"size"},skeleton:{}},emits:["update:list","export"],setup(e,{expose:t,emit:a}){const s=e;let i=$(1),l=$(!1),n=$(!1),r=$(!1),u=$(!1),d=H([]);const c=D((()=>1===i.value)),h=D((()=>!(!r.value||0!==d.length)||i.value>1&&0===d.length&&!1===n.value&&!1===u.value)),v=a;j((()=>s.req),(()=>{n.value=!0,d.length=0,v("update:list",[]),S((()=>{p("init")}))}),{deep:!0}),q((()=>{var e,t;(null==(e=s.list)?void 0:e.length)&&s.req&&console.warn("存在req请求时候，将过滤双向绑定的初始值，请在请求后进行处理"),(null==(t=s.list)?void 0:t.length)&&!s.req&&d.push(...s.list),p("init")}));const f=D((()=>{var e;return null==(e=M())?void 0:e.vnode.key})),p=e=>{return t=this,a=null,c=function*(){if(!s.req)return n.value=!1,l.value=!0,i.value=2,void console.warn("当前base-table未传入req方法，请注意");if(f.value&&s.active&&f.value!==s.active)console.warn(`base-list组件当前未激活，请注意传入的key：${String(f.value)}和active：${s.active}`);else{"init"!==e&&"refresh"!==e||(i.value=1,"init"===e&&(n.value=!0,l.value=!1),n.value=!0);try{u.value=!1;const t=o({},s.req.params);t[s.pageKey]=i.value,t[s.sizeKey]=s.size;const a=yield s.req.fn(t);i.value=i.value+1,"init"!==e&&"refresh"!==e||"init"===e&&(d.length=0,v("update:list",[])),v("export",a);let c=a;if(s.rowKey&&s.rowKey.split(".").forEach((e=>{if(void 0===(null==c?void 0:c[e]))throw console.warn(c),new Error(`row-key：${s.rowKey}不存在，请检查`);c=c[e]})),!Array.isArray(c))throw console.warn(c),new Error("base-list获取数据非数组，请检查返回结果或设置row-key");"refresh"===e&&(d.length=0),d.push(...c),v("update:list",d),n.value=!1,r.value=!1,l.value=c.length<(s.size||10)}catch(t){console.error("获取列表数据失败:",t);const e=String(t);if(-1!==e.indexOf("当前请求已取消")||-1!==e.indexOf("请求过快，已拦截"))return;r.value=!1,l.value=!1,n.value=!1,u.value=!0}}},new Promise(((e,s)=>{var i=e=>{try{n(c.next(e))}catch(t){s(t)}},l=e=>{try{n(c.throw(e))}catch(t){s(t)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(i,l);n((c=c.apply(t,a)).next())}));var t,a,c};return t({refresh:()=>{p("refresh")}}),(e,t)=>{const a=R,i=de,o=te,v=ne;return K(),U(v,{modelValue:I(r),"onUpdate:modelValue":t[3]||(t[3]=e=>L(r)?r.value=e:r=e),"success-text":"刷新成功",class:"fill-available",disabled:!e.pull||!e.req,onRefresh:t[4]||(t[4]=e=>p("refresh"))},{default:Y((()=>{var r;return[I(h)?(K(),V(z,{key:0},[e.$slots.empty?A(e.$slots,"empty",{key:0},void 0,!0):(K(),V("div",ce,[P(a,{type:e.emptyType,image:e.emptyImage,desc:e.emptyDesc},null,8,["type","image","desc"])]))],64)):(K(),U(o,{key:1,error:I(u),"onUpdate:error":t[0]||(t[0]=e=>L(u)?u.value=e:u=e),loading:I(n),"onUpdate:loading":t[1]||(t[1]=e=>L(n)?n.value=e:n=e),"immediate-check":!1,finished:I(l),"finished-text":e.finishedText,"error-text":"请求失败，点击重新加载",onLoad:t[2]||(t[2]=e=>p("more"))},W({default:Y((()=>[A(e.$slots,"default",{},void 0,!0),F("div",{class:Q(["base-list",s.contentClass])},[s.masonry?(K(),U(i,N({key:0},s.masonryConfig,{list:I(d),init:I(c)}),{item:Y((({row:t,index:a})=>[A(e.$slots,"item",{row:t,index:a},void 0,!0)])),_:3},16,["list","init"])):(K(!0),V(z,{key:1},C(I(d),((t,a)=>(K(),V("div",{key:a,class:"base-list-item"},[A(e.$slots,"item",{row:t,index:a},void 0,!0)])))),128))],2)])),_:2},[!I(d).length&&I(n)&&(null==(r=e.skeleton)?void 0:r.length)?{name:"loading",fn:Y((()=>[P(X,{list:e.skeleton},null,8,["list"])])),key:"0"}:void 0]),1032,["error","loading","finished","finished-text"]))]})),_:3},8,["modelValue","disabled"])}}})),[["__scopeId","data-v-eba67c42"]]);export{ve as _};
