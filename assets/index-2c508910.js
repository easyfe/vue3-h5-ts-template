var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{b as n,_ as u}from"./index-f4301285.js";import{O as c,P as i,a as d,_ as p}from"./index-1eed7fa5.js";import{B as v}from"./scan-8c176492.js";import{v as m,h as f,w as y,r as b,N as h,Q as _,P as O,X as w,u as x,_ as g,Z as j,a2 as V,b as P,x as I}from"./core-314477b5.js";const S={id:"video",ref:"video",class:"video",autoplay:""},k=m({name:"BaseScan"}),B=m((C=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&r(e,t,a[t]);if(o)for(var t of o(a))l.call(a,t)&&r(e,t,a[t]);return e})({},k),D={props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(e,{emit:a}){const t=e,o=a,s=f({get:()=>t.modelValue,set:e=>{o("update:modelValue",e)}});y((()=>t.modelValue),(e=>{e&&u()}));let l=b(new v),r=b("请扫描条码，正在尝试识别...."),n=b(!1);const u=()=>{return e=this,a=null,t=function*(){try{r.value="正在调用后置摄像头...",n.value=!0;const e=yield l.value.getVideoInputDevices();if(e.length){let a=e[0].deviceId;const t=JSON.stringify(e[0].label);e.length>1&&(a=t.indexOf("back")>-1?e[0].deviceId:e[1].deviceId),p(a)}}catch(e){console.error(e),d("未发现摄像头,请检查摄像头是否正常!"),n.value=!1,s.value=!1}},new Promise(((o,s)=>{var l=e=>{try{n(t.next(e))}catch(a){s(a)}},r=e=>{try{n(t.throw(e))}catch(a){s(a)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,r);n((t=t.apply(e,a)).next())}));var e,a,t},p=e=>{l.value.reset(),l.value.decodeFromInputVideoDeviceContinuously(e,"video",((e,a)=>{e&&(s.value=!1,o("success",e.text.toString())),a&&!a&&(d("识别失败,请重试!"),console.error(a))}))};return(e,a)=>{const t=c,o=i;return h(),_(o,{show:x(s),"onUpdate:show":a[1]||(a[1]=e=>P(s)?s.value=e:null),class:"scan-popup"},{default:O((()=>[w("div",{class:"scan-box",onClick:a[0]||(a[0]=e=>s.value=!1)},[x(n)?(h(),_(t,{key:0,size:"50",color:"#1989fa",vertical:"",class:"scan-box__loading"},{default:O((()=>[g(j(x(r)),1)])),_:1})):V("",!0),w("video",S,null,512)])])),_:1},8,["show"])}}},a(C,t(D))));var C,D;const N=p(B,[["__scopeId","data-v-d5bef562"]]),U=m({__name:"index",setup(e){let a=b(!1);const t=e=>{d(e)};return(e,o)=>{const s=n,l=N,r=u;return h(),_(r,null,{default:O((()=>[I(s,{type:"primary",onClick:o[0]||(o[0]=e=>P(a)?a.value=!0:a=!0)},{default:O((()=>[g("点击扫码")])),_:1}),I(l,{modelValue:x(a),"onUpdate:modelValue":o[1]||(o[1]=e=>P(a)?a.value=e:a=e),onSuccess:t},null,8,["modelValue"])])),_:1})}}});export{U as default};
