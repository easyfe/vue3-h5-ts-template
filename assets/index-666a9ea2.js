import{c as e,e as t,m as a,n as l,t as r,g as n,H as i,I as o,w as s,u,f as c,M as d,ac as g,ad as f,ae as m,af as v,Y as p,l as h,z as b,d as y,j as S,D as k,V as w,a5 as x,N as B,ag as C,a6 as V}from"./index-1eed7fa5.js";import{v as M,x as I,a as A,r as E,h as P,q as T,w as z,n as q,k as L,A as j,_ as $}from"./core-314477b5.js";import{r as D,a as W,c as F}from"./index-f4301285.js";const[H,N]=e("cell"),O={tag:a("div"),icon:String,size:String,title:l,value:l,label:l,center:Boolean,isLink:Boolean,border:r,iconPrefix:String,valueClass:n,labelClass:n,titleClass:n,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}};const R=s(M({name:H,props:t({},O,D),setup(e,{slots:t}){const a=W(),l=()=>{if(t.label||i(e.label))return I("div",{class:[N("label"),e.labelClass]},[t.label?t.label():e.label])},r=()=>{var a;if(t.title||i(e.title)){const r=null==(a=t.title)?void 0:a.call(t);if(Array.isArray(r)&&0===r.length)return;return I("div",{class:[N("title"),e.titleClass],style:e.titleStyle},[r||I("span",null,[e.title]),l()])}},n=()=>{const a=t.value||t.default;if(a||i(e.value))return I("div",{class:[N("value"),e.valueClass]},[a?a():I("span",null,[e.value])])},s=()=>{if(t["right-icon"])return t["right-icon"]();if(e.isLink){const t=e.arrowDirection&&"right"!==e.arrowDirection?`arrow-${e.arrowDirection}`:"arrow";return I(o,{name:t,class:N("right-icon")},null)}};return()=>{var l;const{tag:i,size:u,center:c,border:d,isLink:g,required:f}=e,m=null!=(l=e.clickable)?l:g,v={center:c,required:!!f,clickable:m,borderless:!d};return u&&(v[u]=!!u),I(i,{class:N(v),role:m?"button":void 0,tabindex:m?0:void 0,onClick:a},{default:()=>{var a;return[t.icon?t.icon():e.icon?I(o,{name:e.icon,class:N("left-icon"),classPrefix:e.iconPrefix},null):void 0,r(),n(),s(),null==(a=t.extra)?void 0:a.call(t)]}})}}})),[K,Y]=e("form");const _=s(M({name:K,props:{colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:l,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:r,showErrorMessage:r,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}},emits:["submit","failed"],setup(e,{emit:t,slots:a}){const{children:l,linkChildren:r}=u(g),n=e=>e?l.filter((t=>e.includes(t.name))):l,i=t=>{return"string"==typeof t?(e=>{const t=l.find((t=>t.name===e));return t?new Promise(((e,a)=>{t.validate().then((t=>{t?a(t):e()}))})):Promise.reject()})(t):e.validateFirst?(a=t,new Promise(((e,t)=>{const l=[];n(a).reduce(((e,t)=>e.then((()=>{if(!l.length)return t.validate().then((e=>{e&&l.push(e)}))}))),Promise.resolve()).then((()=>{l.length?t(l):e()}))}))):(e=>new Promise(((t,a)=>{const l=n(e);Promise.all(l.map((e=>e.validate()))).then((e=>{(e=e.filter(Boolean)).length?a(e):t()}))})))(t);var a},o=(e,t)=>{l.some((a=>a.name===e&&(a.$el.scrollIntoView(t),!0)))},s=()=>l.reduce(((e,t)=>(void 0!==t.name&&(e[t.name]=t.formValue.value),e)),{}),f=()=>{const a=s();i().then((()=>t("submit",a))).catch((l=>{t("failed",{values:a,errors:l});const{scrollToError:r,scrollToErrorPosition:n}=e;r&&l[0].name&&o(l[0].name,n?{block:n}:void 0)}))},m=e=>{d(e),f()};return r({props:e}),c({submit:f,validate:i,getValues:s,scrollToField:o,resetValidation:e=>{"string"==typeof e&&(e=[e]);n(e).forEach((e=>{e.resetValidation()}))},getValidationStatus:()=>l.reduce(((e,t)=>(e[t.name]=t.getValidationStatus(),e)),{})}),()=>{var e;return I("form",{class:Y(),onSubmit:m},[null==(e=a.default)?void 0:e.call(a)])}}}));function G(e){return Array.isArray(e)?!e.length:0!==e&&!e}function J(e,t){const{message:a}=t;return h(a)?a(e,t):a||""}function Q({target:e}){e.composing=!0}function U({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function X(e){return[...e].length}function Z(e,t){return[...e].slice(0,t).join("")}const[ee,te]=e("field");const ae=s(M({name:ee,props:t({},O,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:l,max:Number,min:Number,formatter:Function,clearIcon:a("clear"),modelValue:b(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:a("focus"),formatTrigger:a("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},{rows:l,type:a("text"),rules:Array,autosize:[Boolean,Object],labelWidth:l,labelClass:n,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:t,slots:a}){const l=F(),r=A({status:"unvalidated",focused:!1,validateMessage:""}),n=E(),s=E(),u=E(),{parent:h}=y(g),b=()=>{var t;return String(null!=(t=e.modelValue)?t:"")},M=t=>i(e[t])?e[t]:h&&i(h.props[t])?h.props[t]:void 0,D=P((()=>{const t=M("readonly");if(e.clearable&&!t){const t=""!==b(),a="always"===e.clearTrigger||"focus"===e.clearTrigger&&r.focused;return t&&a}return!1})),W=P((()=>u.value&&a.input?u.value():e.modelValue)),H=P((()=>{var t;const a=M("required");return"auto"===a?null==(t=e.rules)?void 0:t.some((e=>e.required)):a})),N=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===r.status)return;let{value:e}=W;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(G(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return r.status="failed",void(r.validateMessage=J(e,t));if(t.validator){if(G(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise((a=>{const l=t.validator(e,t);p(l)?l.then(a):a(l)}))}(e,t).then((a=>{a&&"string"==typeof a?(r.status="failed",r.validateMessage=a):!1===a&&(r.status="failed",r.validateMessage=J(e,t))}))}}))),Promise.resolve()),O=()=>{r.status="unvalidated",r.validateMessage=""},K=()=>t("endValidate",{status:r.status,message:r.validateMessage}),Y=(a=e.rules)=>new Promise((l=>{O(),a?(t("startValidate"),N(a).then((()=>{"failed"===r.status?(l({name:e.name,message:r.validateMessage}),K()):(r.status="passed",l(),K())}))):l()})),_=t=>{if(h&&e.rules){const{validateTrigger:a}=h.props,l=w(a).includes(t),r=e.rules.filter((e=>e.trigger?w(e.trigger).includes(t):l));r.length&&Y(r)}},ee=(a,l="onChange")=>{var o,s;const u=a;a=(t=>{var a;const{maxlength:l}=e;if(i(l)&&X(t)>+l){const e=b();if(e&&X(e)===+l)return e;const i=null==(a=n.value)?void 0:a.selectionEnd;if(r.focused&&i){const e=[...t],a=e.length-+l;return e.splice(i-a,a),e.join("")}return Z(t,+l)}return t})(a);const c=X(u)-X(a);if("number"===e.type||"digit"===e.type){const t="number"===e.type;if(a=x(a,t,t),"onBlur"===l&&""!==a&&(void 0!==e.min||void 0!==e.max)){const t=B(+a,null!=(o=e.min)?o:-Infinity,null!=(s=e.max)?s:Infinity);+a!==t&&(a=t.toString())}}let d=0;if(e.formatter&&l===e.formatTrigger){const{formatter:t,maxlength:l}=e;if(a=t(a),i(l)&&X(a)>+l&&(a=Z(a,+l)),n.value&&r.focused){const{selectionEnd:e}=n.value,a=Z(u,e);d=X(t(a))-X(a)}}if(n.value&&n.value.value!==a)if(r.focused){let{selectionStart:e,selectionEnd:t}=n.value;if(n.value.value=a,i(e)&&i(t)){const l=X(a);c?(e-=c,t-=c):d&&(e+=d,t+=d),n.value.setSelectionRange(Math.min(e,l),Math.min(t,l))}}else n.value.value=a;a!==e.modelValue&&t("update:modelValue",a)},ae=e=>{e.target.composing||ee(e.target.value)},le=()=>{var e;return null==(e=n.value)?void 0:e.blur()},re=()=>{var e;return null==(e=n.value)?void 0:e.focus()},ne=()=>{const t=n.value;"textarea"===e.type&&e.autosize&&t&&function(e,t){const a=f();e.style.height="auto";let l=e.scrollHeight;if(v(t)){const{maxHeight:e,minHeight:a}=t;void 0!==e&&(l=Math.min(l,e)),void 0!==a&&(l=Math.max(l,a))}l&&(e.style.height=`${l}px`,m(a))}(t,e.autosize)},ie=e=>{r.focused=!0,t("focus",e),q(ne),M("readonly")&&le()},oe=e=>{r.focused=!1,ee(b(),"onBlur"),t("blur",e),M("readonly")||(_("onBlur"),q(ne),V())},se=e=>t("clickInput",e),ue=e=>t("clickLeftIcon",e),ce=e=>t("clickRightIcon",e),de=P((()=>"boolean"==typeof e.error?e.error:!(!h||!h.props.showError||"failed"!==r.status)||void 0)),ge=P((()=>{const e=M("labelWidth"),t=M("labelAlign");if(e&&"top"!==t)return{width:S(e)}})),fe=a=>{if(13===a.keyCode){h&&h.props.submitOnEnter||"textarea"===e.type||d(a),"search"===e.type&&le()}t("keypress",a)},me=()=>e.id||`${l}-input`,ve=()=>{const t=te("control",[M("inputAlign"),{error:de.value,custom:!!a.input,"min-height":"textarea"===e.type&&!e.autosize}]);if(a.input)return I("div",{class:t,onClick:se},[a.input()]);const r={id:me(),ref:n,name:e.name,rows:void 0!==e.rows?+e.rows:void 0,class:t,disabled:M("disabled"),readonly:M("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${l}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:oe,onFocus:ie,onInput:ae,onClick:se,onChange:U,onKeypress:fe,onCompositionend:U,onCompositionstart:Q};return"textarea"===e.type?I("textarea",j(r,{inputmode:e.inputmode}),null):I("input",j((i=e.type,o=e.inputmode,"number"===i&&(i="text",null!=o||(o="decimal")),"digit"===i&&(i="tel",null!=o||(o="numeric")),{type:i,inputmode:o}),r),null);var i,o},pe=()=>{const t=a["right-icon"];if(e.rightIcon||t)return I("div",{class:te("right-icon"),onClick:ce},[t?t():I(o,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},he=()=>{if(e.showWordLimit&&e.maxlength){const t=X(b());return I("div",{class:te("word-limit")},[I("span",{class:te("word-num")},[t]),$("/"),e.maxlength])}},be=()=>{if(h&&!1===h.props.showErrorMessage)return;const t=e.errorMessage||r.validateMessage;if(t){const e=a["error-message"],l=M("errorMessageAlign");return I("div",{class:te("error-message",l)},[e?e({message:t}):t])}},ye=()=>[I("div",{class:te("body")},[ve(),D.value&&I(o,{ref:s,name:e.clearIcon,class:te("clear")},null),pe(),a.button&&I("div",{class:te("button")},[a.button()])]),he(),be()];return c({blur:le,focus:re,validate:Y,formValue:W,resetValidation:O,getValidationStatus:()=>r.status}),T(C,{customValue:u,resetValidation:O,validateWithTrigger:_}),z((()=>e.modelValue),(()=>{ee(b()),O(),_("onChange"),q(ne)})),L((()=>{ee(b(),e.formatTrigger),q(ne)})),k("touchstart",(e=>{d(e),t("update:modelValue",""),t("clear",e)}),{target:P((()=>{var e;return null==(e=s.value)?void 0:e.$el}))}),()=>{const t=M("disabled"),r=M("labelAlign"),n=(()=>{const t=a["left-icon"];if(e.leftIcon||t)return I("div",{class:te("left-icon"),onClick:ue},[t?t():I(o,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])})();return I(R,{size:e.size,class:te({error:de.value,disabled:t,[`label-${r}`]:r}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:ge.value,valueClass:te("value"),titleClass:[te("label",[r,{required:H.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:n&&"top"!==r?()=>n:null,title:()=>{const t=(()=>{const t=M("labelWidth"),r=M("labelAlign"),n=M("colon")?":":"";return a.label?[a.label(),n]:e.label?I("label",{id:`${l}-label`,for:a.input?void 0:me(),"data-allow-mismatch":"attribute",onClick:e=>{d(e),re()},style:"top"===r&&t?{width:S(t)}:void 0},[e.label+n]):void 0})();return"top"===r?[n,t].filter(Boolean):t||[]},value:ye,extra:a.extra})}}}));export{R as C,ae as F,_ as a};
