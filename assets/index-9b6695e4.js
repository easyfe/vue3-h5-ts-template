import{c as e,L as t,a8 as a,aB as l,j as o,f as r,n,E as s,as as i,i as u,m as c,I as d,U as m,t as v,z as f,ay as p,C as h,P as D,G as g,ai as y,a as w,w as b,_ as k}from"./index-1eed7fa5.js";import{F as x,C as S}from"./index-666a9ea2.js";/* empty css              */import"./index-362c4e43.js";import{d as M}from"./dayjs.min-fe5b7145.js";import{u as T}from"./use-refs-9a320d2d.js";import{f as C,b as O}from"./index-f4301285.js";import{a as A}from"./utils-e1458df4.js";import{v as B,h as R,x as j,r as P,w as Y,A as F,a9 as H,a7 as I,N as W,Q as _,P as z,u as V,b as N}from"./core-314477b5.js";const[L,U,$]=e("calendar");function E(e,t){const a=e.getFullYear(),l=t.getFullYear();if(a===l){const a=e.getMonth(),l=t.getMonth();return a===l?0:a>l?1:-1}return a>l?1:-1}function Q(e,t){const a=E(e,t);if(0===a){const a=e.getDate(),l=t.getDate();return a===l?0:a>l?1:-1}return a}const G=e=>new Date(e),K=e=>Array.isArray(e)?e.map(G):G(e);function q(e,t){const a=G(e);return a.setDate(a.getDate()+t),a}function J(e,t){const a=G(e);return a.setMonth(a.getMonth()+t),a.getDate()!==e.getDate()&&a.setDate(0),a}function X(e,t){const a=G(e);return a.setFullYear(a.getFullYear()+t),a.getDate()!==e.getDate()&&a.setDate(0),a}const Z=e=>q(e,-1),ee=e=>q(e,1),te=e=>J(e,-1),ae=e=>J(e,1),le=e=>X(e,-1),oe=e=>X(e,1),re=()=>{const e=new Date;return e.setHours(0,0,0,0),e};const[ne]=e("calendar-day");var se=B({name:ne,props:{item:t(Object),color:String,index:Number,offset:a(0),rowHeight:String},emits:["click","clickDisabledDate"],setup(e,{emit:t,slots:a}){const l=R((()=>{const{item:t,index:a,color:l,offset:o,rowHeight:r}=e,n={height:r};if("placeholder"===t.type)return n.width="100%",n;if(0===a&&(n.marginLeft=100*o/7+"%"),l)switch(t.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":n.background=l;break;case"middle":n.color=l}return t.date&&function(e,t=0){const a=new Date(e.getFullYear(),e.getMonth()+1,0),l=t+e.getDate()-1,o=t+a.getDate()-1;return Math.floor(l/7)===Math.floor(o/7)}(t.date,o)&&(n.marginBottom=0),n})),o=()=>{"disabled"!==e.item.type?t("click",e.item):t("clickDisabledDate",e.item)},r=()=>{const{topInfo:t}=e.item;if(t||a["top-info"])return j("div",{class:U("top-info")},[a["top-info"]?a["top-info"](e.item):t])},n=()=>{const{bottomInfo:t}=e.item;if(t||a["bottom-info"])return j("div",{class:U("bottom-info")},[a["bottom-info"]?a["bottom-info"](e.item):t])},s=()=>{const{item:t,color:l,rowHeight:o}=e,{type:s}=t,i=[r(),a.text?a.text(e.item):e.item.text,n()];return"selected"===s?j("div",{class:U("selected-day"),style:{width:o,height:o,background:l}},[i]):i};return()=>{const{type:t,className:a}=e.item;return"placeholder"===t?j("div",{class:U("day"),style:l.value},null):j("div",{role:"gridcell",style:l.value,class:[U("day",t),a],tabindex:"disabled"===t?void 0:-1,onClick:o},[s()])}}});const[ie]=e("calendar-month");var ue=B({name:ie,props:{date:t(Date),type:String,color:String,minDate:Date,maxDate:Date,showMark:Boolean,rowHeight:n,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number},emits:["click","clickDisabledDate"],setup(e,{emit:t,slots:a}){const[n,c]=l(),d=P(),m=P(),v=C(m),f=R((()=>{return t=e.date,$("monthTitle",t.getFullYear(),t.getMonth()+1);var t})),p=R((()=>o(e.rowHeight))),h=R((()=>{const t=e.date.getDate(),a=(e.date.getDay()-t%7+8)%7;return e.firstDayOfWeek?(a+7-e.firstDayOfWeek)%7:a})),D=R((()=>A(e.date.getFullYear(),e.date.getMonth()+1))),g=R((()=>n.value||!e.lazyRender)),y=t=>{const{type:a,minDate:l,maxDate:o,currentDate:r}=e;if(l&&Q(t,l)<0||o&&Q(t,o)>0)return"disabled";if(null===r)return"";if(Array.isArray(r)){if("multiple"===a)return(t=>{const a=t=>e.currentDate.some((e=>0===Q(e,t)));if(a(t)){const e=Z(t),l=ee(t),o=a(e),r=a(l);return o&&r?"multiple-middle":o?"end":r?"start":"multiple-selected"}return""})(t);if("range"===a)return(t=>{const[a,l]=e.currentDate;if(!a)return"";const o=Q(t,a);if(!l)return 0===o?"start":"";const r=Q(t,l);return e.allowSameDay&&0===o&&0===r?"start-end":0===o?"start":0===r?"end":o>0&&r<0?"middle":""})(t)}else if("single"===a)return 0===Q(t,r)?"selected":"";return""},w=t=>{if("range"===e.type){if("start"===t||"end"===t)return $(t);if("start-end"===t)return`${$("start")}/${$("end")}`}},b=()=>{if(e.showMonthTitle)return j("div",{class:U("month-title")},[a["month-title"]?a["month-title"]({date:e.date,text:f.value}):f.value])},k=()=>{if(e.showMark&&g.value)return j("div",{class:U("month-mark")},[e.date.getMonth()+1])},x=R((()=>{const e=Math.ceil((D.value+h.value)/7);return Array(e).fill({type:"placeholder"})})),S=R((()=>{const t=[],a=e.date.getFullYear(),l=e.date.getMonth();for(let o=1;o<=D.value;o++){const r=new Date(a,l,o),n=y(r);let s={date:r,type:n,text:o,bottomInfo:w(n)};e.formatter&&(s=e.formatter(s)),t.push(s)}return t})),M=R((()=>S.value.filter((e=>"disabled"===e.type)))),T=(l,o)=>j(se,{item:l,index:o,color:e.color,offset:h.value,rowHeight:p.value,onClick:e=>t("click",e),onClickDisabledDate:e=>t("clickDisabledDate",e)},u(a,["top-info","bottom-info","text"]));return r({getTitle:()=>f.value,getHeight:()=>v.value,setVisible:c,scrollToDate:(e,t)=>{if(d.value){const a=s(d.value),l=x.value.length,o=(Math.ceil((t.getDate()+h.value)/7)-1)*a.height/l;i(e,a.top+o+e.scrollTop-s(e).top)}},disabledDays:M}),()=>j("div",{class:U("month"),ref:m},[b(),j("div",{ref:d,role:"grid",class:U("days")},[k(),(g.value?S:x).value.map(T)])])}});const[ce]=e("calendar-header");var de=B({name:ce,props:{date:Date,minDate:Date,maxDate:Date,title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number,switchMode:c("none")},emits:["clickSubtitle","panelChange"],setup(e,{slots:t,emit:a}){const l=R((()=>e.date&&e.minDate&&E(te(e.date),e.minDate)<0)),o=R((()=>e.date&&e.minDate&&E(le(e.date),e.minDate)<0)),r=R((()=>e.date&&e.maxDate&&E(ae(e.date),e.maxDate)>0)),n=R((()=>e.date&&e.maxDate&&E(oe(e.date),e.maxDate)>0)),s=()=>{if(e.showTitle){const a=e.title||$("title"),l=t.title?t.title():a;return j("div",{class:U("header-title")},[l])}},i=e=>a("clickSubtitle",e),u=e=>a("panelChange",e),c=a=>{const s="year-month"===e.switchMode,i=t[a?"next-month":"prev-month"],c=t[a?"next-year":"prev-year"],v=a?r.value:l.value,f=a?n.value:o.value,p=a?"arrow":"arrow-left",h=a?"arrow-double-right":"arrow-double-left",D=j("view",{class:U("header-action",{disabled:v}),onClick:v?void 0:()=>u((a?ae:te)(e.date))},[i?i({disabled:v}):j(d,{class:{[m]:!v},name:p},null)]),g=s&&j("view",{class:U("header-action",{disabled:f}),onClick:f?void 0:()=>u((a?oe:le)(e.date))},[c?c({disabled:f}):j(d,{class:{[m]:!f},name:h},null)]);return a?[D,g]:[g,D]},v=()=>{if(e.showSubtitle){const a=t.subtitle?t.subtitle({date:e.date,text:e.subtitle}):e.subtitle,l="none"!==e.switchMode;return j("div",{class:U("header-subtitle",{"with-switch":l}),onClick:i},[l?[c(),j("div",{class:U("header-subtitle-text")},[a]),c(!0)]:a])}},f=()=>{const{firstDayOfWeek:t}=e,a=$("weekdays"),l=[...a.slice(t,7),...a.slice(0,t)];return j("div",{class:U("weekdays")},[l.map((e=>j("span",{class:U("weekday")},[e])))])};return()=>j("div",{class:U("header")},[s(),v(),f()])}});const me=b(B({name:L,props:{show:Boolean,type:c("single"),switchMode:c("none"),title:String,color:String,round:v,readonly:Boolean,poppable:v,maxRange:f(null),position:c("bottom"),teleport:[String,Object],showMark:v,showTitle:v,formatter:Function,rowHeight:n,confirmText:String,rangePrompt:String,lazyRender:v,showConfirm:v,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:v,closeOnPopstate:v,showRangePrompt:v,confirmDisabledText:String,closeOnClickOverlay:v,safeAreaInsetTop:Boolean,safeAreaInsetBottom:v,minDate:{type:Date,validator:p},maxDate:{type:Date,validator:p},firstDayOfWeek:{type:n,default:0,validator:e=>e>=0&&e<=6}},emits:["select","confirm","unselect","monthShow","overRange","update:show","clickSubtitle","clickDisabledDate","clickOverlay","panelChange"],setup(e,{emit:t,slots:a}){const l=R((()=>"none"!==e.switchMode)),o=R((()=>e.minDate||l.value?e.minDate:re())),n=R((()=>e.maxDate||l.value?e.maxDate:J(re(),6))),i=(e,t=o.value,a=n.value)=>t&&-1===Q(e,t)?t:a&&1===Q(e,a)?a:e,c=(t=e.defaultDate)=>{const{type:a,allowSameDay:l}=e;if(null===t)return t;const r=re();if("range"===a){Array.isArray(t)||(t=[]),1===t.length&&1===Q(t[0],r)&&(t=[]);const e=o.value,a=n.value;return[i(t[0]||r,e,a?l?a:Z(a):void 0),i(t[1]||(l?r:ee(r)),e?l?e:ee(e):void 0)]}return"multiple"===a?Array.isArray(t)?t.map((e=>i(e))):[i(r)]:(t&&!Array.isArray(t)||(t=r),i(t))};let d;const m=P(),v=P(c()),f=P((()=>{const e=Array.isArray(v.value)?v.value[0]:v.value;return e||i(re())})()),b=P(),[k,x]=T(),S=R((()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0)),M=R((()=>{const e=[];if(!o.value||!n.value)return e;const t=new Date(o.value);t.setDate(1);do{e.push(new Date(t)),t.setMonth(t.getMonth()+1)}while(1!==E(t,n.value));return e})),C=R((()=>{if(v.value){if("range"===e.type)return!v.value[0]||!v.value[1];if("multiple"===e.type)return!v.value.length}return!v.value})),A=()=>{const e=y(m.value),a=e+d,l=M.value.map(((e,t)=>k.value[t].getHeight()));if(a>l.reduce(((e,t)=>e+t),0)&&e>0)return;let o,r=0;const n=[-1,-1];for(let s=0;s<M.value.length;s++){const i=k.value[s];r<=a&&r+l[s]>=e&&(n[1]=s,o||(o=i,n[0]=s),k.value[s].showed||(k.value[s].showed=!0,t("monthShow",{date:i.date,title:i.getTitle()}))),r+=l[s]}M.value.forEach(((e,t)=>{const a=t>=n[0]-1&&t<=n[1]+1;k.value[t].setVisible(a)})),o&&(b.value=o)},B=e=>{l.value?f.value=e:g((()=>{M.value.some(((t,a)=>0===E(t,e)&&(m.value&&k.value[a].scrollToDate(m.value,e),!0))),A()}))},H=()=>{if(!e.poppable||e.show)if(v.value){const t="single"===e.type?v.value:v.value[0];p(t)&&B(t)}else l.value||g(A)},I=()=>{e.poppable&&!e.show||(l.value||g((()=>{d=Math.floor(s(m).height)})),H())},W=(e=c())=>{v.value=e,H()},_=e=>{f.value=e,t("panelChange",{date:e})},z=()=>{var e;return t("confirm",null!=(e=v.value)?e:K(v.value))},V=(a,l)=>{const o=e=>{v.value=e,t("select",K(e))};if(l&&"range"===e.type){const l=(a=>{const{maxRange:l,rangePrompt:o,showRangePrompt:r}=e;return!(l&&function(e){const t=e[0].getTime();return(e[1].getTime()-t)/864e5+1}(a)>+l&&(r&&w(o||$("rangePrompt",l)),t("overRange"),1))})(a);if(!l)return void o([a[0],q(a[0],+e.maxRange-1)])}o(a),l&&!e.showConfirm&&z()},N=R((()=>k.value.reduce(((e,t)=>{var a,l;return e.push(...null!=(l=null==(a=t.disabledDays)?void 0:a.value)?l:[]),e}),[]))),L=a=>{if(e.readonly||!a.date)return;const{date:l}=a,{type:o}=e;if("range"===o){if(!v.value)return void V([l]);const[t,a]=v.value;if(t&&!a){const a=Q(l,t);if(1===a){const e=((e,t,a)=>{var l;return null==(l=e.find((e=>-1===Q(t,e.date)&&-1===Q(e.date,a))))?void 0:l.date})(N.value,t,l);if(e){const a=Z(e);-1===Q(t,a)?V([t,a]):V([l])}else V([t,l],!0)}else-1===a?V([l]):e.allowSameDay&&V([l,l],!0)}else V([l])}else if("multiple"===o){if(!v.value)return void V([l]);const a=v.value,o=a.findIndex((e=>0===Q(e,l)));if(-1!==o){const[e]=a.splice(o,1);t("unselect",G(e))}else e.maxRange&&a.length>=+e.maxRange?w(e.rangePrompt||$("rangePrompt",e.maxRange)):V([...a,l])}else V(l,!0)},X=e=>t("clickOverlay",e),te=e=>t("update:show",e),ae=(r,s)=>{const i=0!==s||!e.showSubtitle;return j(ue,F({ref:l.value?b:x(s),date:r,currentDate:v.value,showMonthTitle:i,firstDayOfWeek:S.value,lazyRender:!l.value&&e.lazyRender,maxDate:n.value,minDate:o.value},u(e,["type","color","showMark","formatter","rowHeight","showSubtitle","allowSameDay"]),{onClick:L,onClickDisabledDate:e=>t("clickDisabledDate",e)}),u(a,["top-info","bottom-info","month-title","text"]))},le=()=>{if(a.footer)return a.footer();if(e.showConfirm){const t=a["confirm-text"],l=C.value,o=l?e.confirmDisabledText:e.confirmText;return j(O,{round:!0,block:!0,type:"primary",color:e.color,class:U("confirm"),disabled:l,nativeType:"button",onClick:z},{default:()=>[t?t({disabled:l}):o||$("confirm")]})}},oe=()=>{var r,s;return j("div",{class:U()},[j(de,{date:null==(r=b.value)?void 0:r.date,maxDate:n.value,minDate:o.value,title:e.title,subtitle:null==(s=b.value)?void 0:s.getTitle(),showTitle:e.showTitle,showSubtitle:e.showSubtitle,switchMode:e.switchMode,firstDayOfWeek:S.value,onClickSubtitle:e=>t("clickSubtitle",e),onPanelChange:_},u(a,["title","subtitle","prev-month","prev-year","next-month","next-year"])),j("div",{ref:m,class:U("body"),onScroll:l.value?void 0:A},[l.value?ae(f.value,0):M.value.map(ae)]),j("div",{class:[U("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[le()])])};return Y((()=>e.show),I),Y((()=>[e.type,e.minDate,e.maxDate,e.switchMode]),(()=>W(c(v.value)))),Y((()=>e.defaultDate),(e=>{W(e)})),r({reset:W,scrollToDate:B,getSelectedDate:()=>v.value}),h(I),()=>e.poppable?j(D,{show:e.show,class:U("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,onClickOverlay:X,"onUpdate:show":te},{default:oe}):oe()}})),ve=k(B({__name:"index",props:H({options:{},format:{type:Function,default:e=>M(e).format("YYYY-MM-DD")}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,a=P(!1),l=I(e,"modelValue"),o=R((()=>{var e;return l.value?null==(e=t.format)?void 0:e.call(t,l.value):""}));function r(e){Array.isArray(e)?l.value=e.map((e=>e.toLocaleDateString())):l.value=e.toLocaleDateString(),a.value=!1}return(e,l)=>{const n=x,s=me,i=S;return W(),_(i,{class:"base-picker_wrapper"},{default:z((()=>[j(n,F({"model-value":V(o),"right-icon":"arrow",readonly:"",placeholder:"请选择"},e.$attrs,{onClick:l[0]||(l[0]=e=>a.value=!0)}),null,16,["model-value"]),j(s,F({show:V(a),"onUpdate:show":l[1]||(l[1]=e=>N(a)?a.value=e:null)},t.options,{onConfirm:r}),null,16,["show"])])),_:1})}}}),[["__scopeId","data-v-05047c49"]]);export{ve as default};
